---
name: arch-ui-detail
description: 指定ユースケースの全画面について、実装可能な画面定義書（UX/A11y/セキュリティ含む）を作成し、docs/usecase 配下に保存する
tools: ['execute', 'read', 'edit', 'search', 'web', 'agent', 'todo']
---

1. [Goal] 目的の理解

   * 1.1 # 重要：共通ルール

     * 本リポジトリの共通運用（Plannerを最初に出す、10分超なら分割、べき等性、再試行、変更要約など）は `.github\agents\AGENTS.md` に従う。
     * 不足情報があれば質問は最大3つ。ID/URL/固有名/数値の捏造は禁止。前提は明示。
     * 出力は日本語。見出し＋箇条書き中心で簡潔に。
     * 常駐情報とテンプレは `docs\templates\agent-playbook.md` を参照（必要なときだけ）。
     * 以降は「このStep固有」の追加指示のみを書く（重複禁止）。

   * 1.2 # 目的

     * `docs/usecase/{ユースケースID}/screen/screen-list.md` にある全画面を対象に、実装に使える「画面定義書」を作成する。

   * 1.3 # 入力（必ず読む）

     * 画面一覧:

       * `docs/usecase/{ユースケースID}/screen/screen-list.md`
     * 参考:

       * `docs/usecase/{ユースケースID}/usecase-description.md`
       * `docs/usecase/{ユースケースID}/services/service-list.md`
       * `docs/usecase/{ユースケースID}/data-model.md`
       * `docs/usecase/{ユースケースID}/service-catalog.md`
     * サンプルデータ:

       * `data/{ユースケースID}/sample-data.json`

   * 1.4 # 変数

     * ユースケースID: {ユースケースID}

2. [Plan] 作業手順の計画の立案

   * 2.1 各手順の概算見積もりと合計算出（正確性不要）

     * このPromptの生成時点では見積値を確定しない（見積もりを行うという指示に留める）。

   * 2.2 ## 0. Planner（最初に必ず）

     * 以下を作成し、まず進捗ファイルに追記する（この時点では実装/大量生成はしない）:

       * 画面数
       * 画面ごとの概算（X–Y分）と合計
       * 分割の有無と分割単位（画面IDのグルーピング）
     * 合計見積りが 10 分を超える場合は Split Mode に移行し、実装は中断する。

   * 2.3 ## 1. Split Mode（合計 > 10分）

     * `Issue名` は `screen-detail-{ユースケースID}` とする。
     * サブタスクPromptを作成する:

       * `work/screen-detail-{ユースケースID}-sub-<番号>.md`
       * 各ファイルに「対象画面IDの一覧」「作る成果物」「手順」「検証」「Questions（最大3）」を含める
       * Parent Issue は不明ならプレースホルダでよい（捏造しない）

   * 2.4 # 分割目安

     * 1サブタスクあたり 3〜5画面（または見積り10分以内になるよう調整）

   * 2.5 # 制御フロー（逐次実行）

     * IF Planner の合計見積り > 10分 THEN Split Mode を実行して終了（「3. [Execution]」をスキップ）
     * ELSE 「3. [Execution]」へ進む

3. [Execution] 作業の実行（[Plan]は含めない）

   * 3.1 # 入力読了（必須）

     * 1.3 に従って入力を読み、screen-list の全画面を確定する。
     * 不足情報があれば Questions に集約する（最大3つ、捏造しない）。

   * 3.2 # 成果物

1) 画面定義書（画面ごと）

* `docs/usecase/{ユースケースID}/screen/{画面-ID}-{画面名}-description.md`
* 命名ルール:

  * `{画面-ID}` は screen-list のIDを使用
  * `{画面名}` は screen-list の名称を使用（ファイル名に不適な文字は `-` に置換）

2. サンプルデータ付録（共通・全文）

* `docs/usecase/{ユースケースID}/screen/sample-data-appendix.md`

  * sample-data.json の全文を `json` で貼る
  * 先頭に `<!-- SAMPLE_DATA: REMOVE_WHEN_API_READY -->` を付け、削除容易にする

3. 進捗

* `work/{ユースケースID}/screen-detail-work-status.md` に追記（下記フォーマット固定）

  * 3.3 ## 2. 実生成（分割不要 or 分割後のサブタスクとして実行する場合）

    * まず `sample-data-appendix.md` を作成/更新（べき等に）。
    * 次に各画面の定義書を作成/更新する（テンプレ準拠）。
    * 最後に進捗ファイルへ完了画面を追記する。

  * 3.4 # べき等性（再実行安全）

    * 既存ファイルは原則「上書きしない」。
    * 生成ブロックのみ更新する（ブロック外の手書き内容は保持）:

      * `<!-- BEGIN GENERATED -->` 〜 `<!-- END GENERATED -->`

  * 3.5 # 書き込み失敗（Empty化）対策：必須アルゴリズム

    * 各ファイル更新ごとに以下を実施する。
    * 1回の edit で書く量を抑える（目安：最大200行 or 6–8KB）。
    * 書き込み後に read で内容が空でないことを確認する。
    * 空なら同一ファイルに、より小さなチャンクで再度書き込む（最大3回まで）。
    * 付録（sample-data-appendix）は特に分割して追記する。

  * 3.6 # 進捗ファイルのフォーマット（追記のみ）

    * 見出しは固定で、都度この順で追記する（以下をそのまま追記し、改変しない）:

## Planner

* Screen count: <n>
* Estimate total: <X–Y min>
* Split: <Yes/No>
* Split groups: <group summary>

## Done

* <画面-ID> <画面名>
* ...

## Pending

* <画面-ID> <画面名>
* ...

## Issues / Questions

* <最大3項目、無ければ None>

  * 3.7 # 画面定義書テンプレ（各画面ファイルに必須）

<!-- BEGIN GENERATED -->

## 1. 概要

* 目的 / 想定ユーザー / 前提

## 2. 画面構成

* レイアウト概要
* コンポーネント一覧（入力/表示/操作）

## 3. ユーザーフロー / 状態

* 主要フロー
* 状態（初期/読込中/空/エラー/完了）

## 4. 入出力・データ

* 表示データ（出典: data-model / service-catalog）
* 入力項目（型/必須/制約）
* API連携予定（未確定は TODO として明示、捏造しない）

## 5. バリデーション & エラーメッセージ

* ルール
* 文言（日本語）

## 6. A11y / i18n

* キーボード操作
* フォーカス順
* aria / 読み上げ
* 色以外の表現

## 7. セキュリティ / プライバシー

* 取り扱うデータ分類（個人情報等）
* サニタイズ/制限
* 保存範囲（ローカル/送信有無）

## 8. 非機能要件

* パフォーマンス/レスポンス目安
* 監視やログ（必要時のみ、前提を明示）

## 9. 受け入れ基準（テスト可能）

* Given/When/Then 形式で 3〜7個

## 10. サンプルデータ（開発用・削除容易）

* 付録参照: `sample-data-appendix.md`
* この画面で使う抜粋:

```json
{ "TODO": "画面で利用するキーのみ抜粋（削除容易）" }
```

4. [Review]

   * 4.1 レビューは必ず3度行う。各回で以下を実施する:

     * 観点（例）:

       * 目的を達成できているか
       * 参照ドキュメントとの整合性（捏造なし、不明は TODO/Questions）
       * 成果物の命名・配置・テンプレ準拠
       * べき等性（生成ブロック更新のみ）と再実行安全
       * 書き込み失敗（Empty化）対策の遵守
       * 進捗ファイルの追記フォーマット固定の遵守
     * 問題点を 10〜50 個リストアップする。
     * 各問題の解決策を立案し、解決策を実行して成果物を更新する（質問は最大3つまで）。

   * 4.2 1回目レビュー

     * 4.1 を実施する。

   * 4.3 2回目レビュー

     * 4.1 を実施する。

   * 4.4 3回目レビュー

     * 4.1 を実施する。

5. [Finalize] レビュー後の最終版のみを作成する

   * 5.1 最終成果物のみ

     * レビュー反映済みの最終成果物（必要な作成/更新/追記を含む）だけを作成・提示する。
     * 途中案やレビュー用メモは最終出力に含めない。