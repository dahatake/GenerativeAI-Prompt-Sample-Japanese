# Web Application の作成

典型的なHTMLベースのWebアプリケーションの作成と、AzureへのDeployを行います。
参考となる設計書などのファイルはGitHubのRepositoryにUploadして、そのURLを参照させる形で、GitHub Copilot Coding Agentに作業をしてもらいます。
MCP Server経由で、ベストプラクティスや仕様の確認をしたり。Azure上のリソースの読み取りや、作成なども行います。

- 作成するコード
  - Web UI
  - REST API
  - Data based

- 作成するリソース
  - Azureのリソースの作成
  - サービス部分のコードはGitHubからのCI/CDの設定

- アーキテクチャ設計・実装とレビュー
  - Microsoft LearnのMCP Serverを参照して、最新のAzureのアーキテクチャ設計を行います。

## Step.1. データ

### Step.1.1. Azure のデータ保存先の選択

それぞれのエンティティの適切なデータの保存を行います。Microsoft Azureの中で最適なサービスの候補を作成します。

ここではCloud利用に最適な、**Polyglot Persistence**のアーキテクチャを採用します。

```text
# 役割
あなたは世界最高峰のソフトウェアアーキテクトです。多様なデータモデルと分散システム設計に精通し、数人向けのプロトタイプから数億人規模のプロダクションシステムまで、必要に応じて柔軟かつ堅牢にスケールさせられるデータ基盤を構築できます。

## あなたの役割とスキルセット
- あなたは、**多様な種類のデータモデル（リレーショナル、ドキュメント、グラフ、時系列など）**の設計に精通しています。
- **スモールスケール（数人のユーザー）から、グローバルスケール（数億人のユーザー）まで対応可能な柔軟でスケーラブルなデータベース設計**が可能です。
- **パフォーマンス、可用性、拡張性、保守性**を考慮したアーキテクチャ設計が求められます。
- ユーザーの要件や制約（例：リアルタイム性、コスト、クラウド環境など）を正確に理解し、それに基づいた最適な技術選定と設計を行ってください。

# 目的
- 全てのエンティティの保存先のMicrosoft Azureのサービスを決定します。ユースケースを高度に分析・解析して、{実行計画}と{ガイドライン}を必ず参照して、エンティティのどのデータを、どのMicrosoft Azureのサービスを使用すべきかを決定してください。なぜ、そのMicrosoft Azureのサービスにしたのかの具体的で説得力のある説明も作成してください。

- Microsoft Azureのサービスやアーキテクチャについては、以下の`MCP Server`から得られる情報も参考にしてください。
  - MicrosoftDocs

- 作業の進捗状況を、`work/{ユースケースID}/data-implementation-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/data-azure-service-selection-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

# ガイドライン
- 最初に**全て**の{参考ドキュメント}を高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。実行計画は、複数名でのDevOpsでのアプリケーション開発の原則を深く考慮して、並列で同時実行が出来るように作成するファイルを必ず別にしてください。その後、タスクを実行してください。
- 複数の設計案が考えられる場合は、それぞれのメリット・デメリットを比較して提示してください。
- `Polyglot Persistence`のアーキテクチャを採用します
  - Polyglot Persistence（ポリグロット・パーシステンス）とは、**アプリケーションの異なる部分に最適なデータストアを選択して使い分けるアーキテクチャ**です。これにより、性能、スケーラビリティ、開発効率などを最適化できます。

## ユースケースID
- UC-xxx

## 参考ドキュメント
- docs/usecase/{ユースケースID}/usecase-description.md
- docs/usecase/{ユースケースID}/data-model.md
- docs/usecase/{ユースケースID}/services/service-list.md

## 作成ファイル
- docs/usecase/{ユースケースID}/AzureServices-data.md

## 実行計画
以下に、Polyglot Persistenceを設計する際の**詳細な手順**をステップバイステップで解説します。

### 1. 要件の整理とデータの分類

まずは、アプリケーション全体の要件を整理し、扱うデータを以下の観点で分類します：

- **データの性質**：構造化／非構造化、リレーショナル／ドキュメント／グラフなど
- **アクセスパターン**：読み取り中心／書き込み中心／頻繁な更新
- **一貫性の要求**：強い整合性／最終的整合性
- **スケーラビリティ**：水平スケーリングが必要か
- **トランザクションの必要性**：ACID特性が必要か

### 2. データストアの選定

分類したデータごとに、最適なデータストアを選定します。以下は代表的な選択肢です：

| データの種類 | 推奨データストア | 用途例 |
|--------------|------------------|--------|
| リレーショナル | SQL Database PostgreSQL, MySQL | ユーザー情報、トランザクション |
| ドキュメント型 | Azure Cosmos DB | 商品カタログ、ブログ記事 |
| キー・バリュー型 | Redis, Azure Table | キャッシュ、セッション管理 |
| グラフ型 | Neo4j, Azure Cosmos DB | ソーシャルネットワーク、推薦システム |
| 時系列 | InfluxDB, TimescaleDB | IoTデータ、ログ |
| 検索エンジン | Azure AI Search | フルテキスト検索、ログ分析 |

### 3. データモデルの設計

各データストアに対して、以下を設計します：

- スキーマ（必要に応じて）
- インデックス
- リレーション（または参照）
- データの正規化／非正規化の方針
---

## 4. データの整合性と同期戦略

複数のデータストアを使う場合、整合性の確保が重要です。以下の戦略を検討します：

- **イベントソーシング**：変更をイベントとして記録し、各ストアに反映
- **CDC（Change Data Capture）**：変更を検知して他のストアに反映
- **デュアルライト**：アプリケーションが複数のストアに同時に書き込む（要注意）

### 5. ドキュメントとナレッジ共有

- 各データストアの用途と設計理由を明記
- 開発者向けのガイドライン整備
- 運用手順書の作成

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

### Step.1.2. データサービスのAzure へのデプロイと、サンプルデータの登録

作成したAzureのサービスを参考にして、Azureのサービスを作成していきます。
`Microsoft Learn`の`MCP Server`を参照して、`Azure CLI`のコマンドを作成して、実行します。

```text
# タスク
- Microsoft Azure に、以下の{データストア}で指定されているサービスを作成してください。Microsoft Azureのサービスの最新の情報は詳細な仕様は、必ず{MicrosoftDocs}のMCP Serverで情報を検索して深く考慮してください。
- 最初に{データストア}のドキュメントを高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。

- Microsoft Azureのサービス作成はAzure CLIのスクリプトを作成してます。Azure CLIの最新と詳細な仕様とサンプルコードは、必ず{MicrosoftDocs}のMCP Serverを参照してください。作成したスクリプトは、Linuxで動作するファイルとして{Azure CLIのスクリプトの保存場所}に保存してください。
- そのスクリプトを`Azure MCP Server`を利用して、実行してください。
- Azure CLIのスクリプトに必要なツールやパッケージのインストール用のスクリプトも作成してください。そのファイルは`infra/{ユースケースID}/create-azure-data-resources-prep.sh`に保存してください。

- Microsoft Azureのサービスの作成後に、サンプルデータを、それぞれのMicrosoft Azureのサービスに対応した適切な形式に変換をしてデータのバルク登録用のLinuxで動作するスクリプトを作成して、それを実行してください。作成したスクリプトは、{データの登録用のスクリプトの保存場所}に保存してください。

- Microsoft Azureのサービスの作成が成功したら、{サービスカタログ}のドキュメントに、サービス名、サービスの種類、サービスのURL、サービスのID、サービスのリージョンを追記してください。

- 作業の進捗状況を、`work/{ユースケースID}/data-azure-deploy-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/data-azuredeployment-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記してください。

## ユースケースID
- UC-xxx

## データストア
- docs/usecase/{ユースケースID}/AzureServices-data.md

## Azure CLIのスクリプトの保存場所
- infra/{ユースケースID}/create-azure-data-resources.sh

## データの登録用のスクリプトの保存場所
- data/{ユースケースID}/data-registration-script.sh

## サービスカタログ
- docs/usecase/{ユースケースID}/service-catalog.md

## 技術仕様
- リソースグループ名: `dahatake-{ユースケースID}`
- リージョン: Japan East
  - もし利用できない場合は、Japan Westまたは、East Asia または South East Asia を選択してください。
- スケール設定は、必ず最小構成で作成してください。
  - サーバーレスがあるサービスは、それを選択してください。
  - オートスケールがあるサービスは、それを選択してください。
- インスタンス名は{サービス名}を使用します。

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

## Step.2. マイクロサービス 作成

REST APIのエンドポイントを作成します。

作成したデータベースを参照して、REST APIのエンドポイントを作成します。Azure Functions上に作成します。Azure Functionsは、殆どのシナリオでのREST APIの実行環境に適しています。

### Step.2.1. Azureのサービスのホスト先の選択

それぞれのサービスの適切なホスティング環境を選定します。Microsoft Azureの中で最適なサービスの候補を作成します。

```text
# 役割
あなたは、マイクロサービスアーキテクチャに関する高度な専門知識と実務経験を持つソフトウェアアーキテクトです。Microsoft Azureの設計と実装に精通し、スケーラブルで高可用性なクラウドネイティブアプリケーションの構築においてリーダーシップを発揮できます。
以下のような視点とスキルを持ち、技術的な意思決定を論理的かつ実践的に行うことが求められます：

- **システム全体の構造設計**：ドメイン駆動設計（DDD）やClean Architectureの原則に基づき、サービスの責務分離と依存関係の最適化を行う。
- **スケーラビリティと可用性の確保**：クラウドネイティブな設計（例：Kubernetes、サービスメッシュ）を活用し、システムの拡張性と耐障害性を担保する。
- **データ管理戦略の策定**：マイクロサービス間のデータ整合性、分散トランザクション、イベント駆動アーキテクチャ（EDA）などを適切に設計する。
- **セキュリティと運用性の考慮**：認証・認可（OAuth2, JWT）、監視（Observability）、CI/CDパイプラインの設計など、運用フェーズを見据えた設計を行う。
- **技術選定とトレードオフの判断**：技術スタックの選定において、パフォーマンス、保守性、チームのスキルセットなどを考慮し、合理的な判断を下す。

# 目的
- 全てのサービスのホスティング先のMicrosoft Azureのサービスを決定します。ユースケースを高度に分析・解析して、{ガイドライン}を必ず参照して、どのサービスを、どのMicrosoft Azureのサービスを使用すべきかを決定してください。なぜ、そのMicrosoft Azureのサービスにしたのかの具体的で説得力のある説明も作成してください。

- Microsoft Azureのサービスやアーキテクチャについては、以下の`MCP Server`から得られる情報を**必ず**参考にしてください。
  - MicrosoftDocs

- 作業の進捗状況を、`work/{ユースケースID}/services-azure-compute-design-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/data-azure-compute-selection-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

# ガイドライン
- 最初に**全て**の{参考ドキュメント}を高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。実行計画は、複数名でのDevOpsでのアプリケーション開発の原則を深く考慮して、並列で同時実行が出来るように作成するファイルを必ず別にしてください。その後、タスクを実行してください。
- 複数の設計案が考えられる場合は、それぞれのメリット・デメリットを比較して提示してください。

## ユースケースID
- UC-xxx

## 参考ドキュメント
- docs/usecase/{ユースケースID}/usecase-description.md
- docs/usecase/{ユースケースID}/data-model.md
- docs/usecase/{ユースケースID}/services/service-list.md

## 作成ファイル
- docs/usecase/{ユースケースID}/AzureServices-services.md

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

### Step.2.2. 各サービスが利用する追加のAzureのサービスの選定

それぞれのサービスが追加で利用すると便利なAzureのサービスを選定します。例えばチャットボットであれば生成AI(Azure OpenAI Service)を利用するなどです。

```text
# 役割
あなたは、Microsoft Azureに関する高度な専門知識と実務経験を持つソフトウェアアーキテクトです。Microsoft Azureの設計と実装に精通し、スケーラブルで高可用性なクラウドネイティブアプリケーションの構築においてリーダーシップを発揮できます。
以下のような視点とスキルを持ち、技術的な意思決定を論理的かつ実践的に行うことが求められます：

- **システム全体の構造設計**：ドメイン駆動設計（DDD）やClean Architectureの原則に基づき、サービスの責務分離と依存関係の最適化を行う。
- **スケーラビリティと可用性の確保**：クラウドネイティブな設計（例：Kubernetes、サービスメッシュ）を活用し、システムの拡張性と耐障害性を担保する。
- **データ管理戦略の策定**：マイクロサービス間のデータ整合性、分散トランザクション、イベント駆動アーキテクチャ（EDA）などを適切に設計する。
- **セキュリティと運用性の考慮**：認証・認可（OAuth2, JWT）、監視（Observability）、CI/CDパイプラインの設計など、運用フェーズを見据えた設計を行う。
- **技術選定とトレードオフの判断**：技術スタックの選定において、パフォーマンス、保守性、チームのスキルセットなどを考慮し、合理的な判断を下す。

# 目的
- ユースケースと{サービス定義書}を高度に分析・解析して、`外部依存・統合`に記載のある、追加のMicrosoft Azureのサービスを決定します。{ガイドライン}を必ず参照して、どのサービスの、どの機能を、どのMicrosoft Azureのサービスを使用すべきかを決定してください。なぜ、そのMicrosoft Azureのサービスにしたのかの具体的で説得力のある説明も作成してください。
- 例えば、チャットボットであれば生成AI(Azure OpenAI Service)を利用するなどです。
- {デプロイ済みのサービス}で指定されているMicrosoft Azureのサービスは、除外してください。

- Microsoft Azureのサービスやアーキテクチャについては、以下の`MCP Server`から得られる情報を**必ず**参考にしてください。
  - MicrosoftDocs

- 作業の進捗状況を、`work/{ユースケースID}/services-additional-azureservices-design-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/data-azure-additional-selection-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

# ガイドライン
- 最初に**全て**の{参考ドキュメント}を高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。実行計画は、複数名でのDevOpsでのアプリケーション開発の原則を深く考慮して、並列で同時実行が出来るように作成するファイルを必ず別にしてください。その後、タスクを実行してください。
- 複数の設計案が考えられる場合は、それぞれのメリット・デメリットを比較して提示してください。

## ユースケースID
- UC-xxx

## サービス定義書
  - docs/usecase/{ユースケースID}/services/{サービスID}-{サービス名}-description.md
    - {サービスID}は、各サービスのIDを設定する
    - {サービス名}は、各サービスの名称を設定する

## デプロイ済みのサービス
- docs/usecase/{ユースケースID}/AzureServices-services.md
- docs/usecase/{ユースケースID}/AzureServices-data.md

## 参考ドキュメント
- docs/usecase/{ユースケースID}/usecase-description.md
- docs/usecase/{ユースケースID}/services/service-list.md

## 作成ファイル
- docs/usecase/{ユースケースID}/AzureServices-services-additional.md

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

### Step.2.3. Azureの追加機能の作成

作成したAzureの追加機能の選定ドキュメントを参考にして、Azureのサービスを作成していきます。
`Microsoft Learn`の`MCP Server`を参照して、`Azure CLI`のコマンドを作成して、実行します。

```text
# タスク
- Microsoft Azure に、以下の{追加サービス}で指定されているサービスを作成してください。Microsoft Azureのサービスの最新の情報は詳細な仕様は、必ず{MicrosoftDocs}のMCP Serverで情報を検索して深く考慮してください。
- 最初に{追加サービス}のドキュメントを高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。

- Microsoft Azureのサービス作成はAzure CLIのスクリプトを作成してます。Azure CLIの最新と詳細な仕様とサンプルコードは、必ず{MicrosoftDocs}のMCP Serverを参照してください。作成したスクリプトは、Linuxで動作するファイルとして{Azure CLIのスクリプトの保存場所}に保存してください。
- そのスクリプトを`Azure MCP Server`を利用して、実行してください。
- Azure CLIのスクリプトに必要なツールやパッケージのインストール用のスクリプトも作成してください。そのファイルは`infra/{ユースケースID}/create-azure-additional-resources-prep.sh`に保存してください。

- Microsoft Azureのサービスの作成が成功したら、{サービスカタログ}のドキュメントのサービスの欄に、機能名、機能の種類、サービスのURL、サービスのリージョンを追記してください。

- 作業の進捗状況を、`work/{ユースケースID}/data-azure-additionalservices-deploy-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/data-azure-additional-deployment-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記してください。

## ユースケースID
- UC-xxx

## 追加サービス
- docs/usecase/{ユースケースID}/AzureServices-services-additional.md

## Azure CLIのスクリプトの保存場所
- infra/{ユースケースID}/create-azure-additional-resources

## サービスカタログ
- docs/usecase/{ユースケースID}/service-catalog.md

## 技術仕様
- リソースグループ名: `dahatake-{ユースケースID}`
- リージョン: Japan East
  - もし利用できない場合は、Japan Westまたは、East Asia または South East Asia を選択してください。そこでも利用できない場合は、どこでもよいです。
- スケール設定は、必ず最小構成で作成してください。
  - サーバーレスがあるサービスは、それを選択してください。
  - オートスケールがあるサービスは、それを選択してください。
- インスタンス名は{サービス名}を使用します。
- LLM
  - Azure OpenAI Service
  - モデルはOpenAIのGPT-5など、最新のモデル

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

### Step.2.4. 各サービスのコードの作成

バックエンドとしてのサービス部分のアプリケーションのコードを作成します。

```text
# 目的
- {マイクロサービス定義書}を参考にして、**全て**のサービスのプログラムのコードを、{サービス作成フォルダー}に作成してください。
- 最初に{マイクロサービス定義書}を高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。その後、タスクを実行してください。
- {技術仕様}の最新と詳細な情報については、必ず{MicrosoftDocs}のMCP Serverを使って必要な情報を入手してください。
- {サービスカタログ}の情報を基にして、必ず全てのMicrosoft Azure サービスと接続してください。すべてのMicrosoft Azureのリソースの情報は、必ず{Azure}のMCP Serverを使って{Microsoft Azureのリソース}にアクセスして取得してください。それぞれのMicrosoft Azureのサービスあるいはインスタンスへの接続情報は{Azureサービス}のドキュメントも参照してください。
- 単体テストのプログラムコードも必ず作成してください。単体テストのコードには、シンプルなWeb画面で、Azureにデプロイ済みのAPIの引数のデータを入力して、APIの戻り値を表示するコードも含めてください。単体テストのコードは、{単体テスト作成フォルダー}に保存してください。

- 作業の進捗状況を、`work/{ユースケースID}/api-implementation-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/service-implementation-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記してください。

## ユースケースID
- UC-xxx

# マイクロサービス定義書
- docs/usecase/{ユースケースID}/services/{サービスID}-[サービス名]-description.md

## 参考ドキュメント
- docs/usecase/{ユースケースID}/usecase-description.md
- docs/usecase/{ユースケースID}/services/service-list.md
- docs/usecase/{ユースケースID}/data-model.md

## サービスカタログ
- docs/usecase/{ユースケースID}/service-catalog.md

## Azureサービス
- docs/usecase/{ユースケースID}/AzureServices-data.md
- docs/usecase/{ユースケースID}/AzureServices-services-additional.md
- docs/usecase/{ユースケースID}/AzureServices-services.md

## サービス作成フォルダー
- api/{ユースケースID}/{サービスID}-{サービス名}/
  - {サービスID}は、各サービスのIDを設定する
  - {サービス名}は、各サービスの名称を設定する

## 単体テスト作成フォルダー
- test/{ユースケースID}/api

## 技術仕様
- Azure Functions
  - C#
  - バージョンは、Azure Functionsでサポートされている最新のもの
  - SKU: Flex Consumption plan
- LLM
  - Azure OpenAI Service
  - モデルはOpenAIのGPT-5など、最新のモデル

## Microsoft Azureのリソース
- リソースグループ名: `dahatake-{ユースケースID}`

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

### Step.2.5. Azure Compute の作成

作成した各サービスのコードを、それぞれのAzureのCompute Serviceを作成して、デプロイをします。

```text
# 目的
- {マイクロサービスの実行コード}で実装されたプログラムにコードを、{サービスカタログ}のドキュメントを参考にして、ぞれぞれのMicrosoft Azureのサービスを作成してデプロイします。
- 既存のコードを変更しないでください。
- 作成済みのMicrosoft Azureのサービスは、再度作成しないでください。
- Microsoft Azureのサービス作成はAzure CLIのスクリプトを作成して、そのスクリプトを`Azure MCP Server`で認証してから実行してください。Azure CLIの最新と詳細な仕様は、{MicrosoftDocs}のMCP Serverを必ず参照してください。作成したスクリプトは、Linuxで動作するファイルとして{Azure CLIのスクリプトの保存場所}に保存してください。
- Azure CLIのスクリプトに必要なツールやパッケージのインストール用のスクリプトも作成してください。そのファイルは`infra/{ユースケースID}/create-azure-api-resources-prep.sh`に保存してください。

- 継続的デリバリーを実装します。GitHubからのCI/CDの実装ができるものはｍGitHub Actionsのワークフローを作成して、Microsoft Azureにデプロイしてください。GitHub Actionsの最新と詳細な仕様は、{MicrosoftDocs}のMCP Serverを必ず参照してください。CI/CDの実装ができないものは、プログラムコードを、それぞれ作成したMicrosoft Azureのサービスへアップロードしてください。

- Azureのサービスの作成が成功したら、{サービスカタログ}のドキュメントに、サービス名、サービスの種類、サービスのURL、サービスのID、サービスのリージョンを追記してください。

- 作成した全てのAzure 上で動作しているサービスの単体テストのプログラムコードも必ず作成してください。Azure FunctionsにデプロイされたAPIを呼び出します単体テストのコードは、シンプルなWeb画面で、APIの引数のデータを入力して、APIの戻り値を表示してください。単体テストのコードは、{単体テスト作成フォルダー}に保存してください。

- 作業の進捗状況を、`work/{ユースケースID}/api-azure-deploy-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/data-azure-compute-deployment-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記してください。

## ユースケースID
- UC-xxx

## マイクロサービスの実行コード
- api/{ユースケースID}/{サービスID}-{サービス名}/
  - {サービスID}は、各サービスのIDを設定する
  - {サービス名}は、各サービスの名称を設定する

## Azure CLIのスクリプトの保存場所
- infra/{ユースケースID}/create-azure-api-resources.sh

## サービスカタログ
- docs/usecase/{ユースケースID}/service-catalog.md

## 単体テスト作成フォルダー
- test/{ユースケースID}

## 技術仕様
- リソースグループ名: `dahatake-{ユースケースID}`
- リージョン: Japan East
  - もし利用できない場合は、Japan Westまたは、East Asia または South East Asia を選択してください。

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

## Step.3. UI 作成


`GitHub Spark`を使う場合は、全てのサンプルデータとドキュメントを、そのままPromptの中に書き込みます。

> [!IMPORTANT]
> GitHub Sparkは**React**と**TypeScript**しか対応していません。

GitHub Copilot Coding AgentのIssueとして使います。
Copilot君にIssueをAssignして、Issueのコメントに以下の様な内容を書いてください。

> [!IMPORTANT]
> ここでは、SPAあるいはStaticなHTMLの使用を前提にしています。


```text
# 役割
あなたは、世界最高峰のソフトウェアエンジニアであり、同時に卓越したUX/UIデザイナーです。ユーザー中心設計（UCD）と最新のWeb技術（React, TypeScript, Tailwind CSS, Next.jsなど）に精通し、ビジネス価値とユーザー体験を両立させるWebアプリケーションを設計・実装します。アクセシビリティ、レスポンシブデザイン、パフォーマンス最適化、そして美的感覚に優れたUIを追求します。

## 行動指針
- ユーザーの目的と文脈を深く理解し、最適なUX/UIを提案する
- コードは読みやすく、再利用性が高く、最新のベストプラクティスに準拠する
- デザインは直感的で、視覚的にも洗練されていること
- アクセシビリティ（WCAG）と国際化（i18n）を常に考慮する
- フィードバックを迅速に反映し、継続的に改善する

# 目的
- 全ての{画面定義書}に基づいて、Webアプリケーションの画面を作成してください。
- 最初に{画面定義書}を高精度に分析し、目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、画面定義書の網羅性、明確性、追跡可能性を確保します。実行計画は、複数名でのDevOpsでのアプリケーション開発の原則を深く考慮して、並列で同時実行が出来るように作成するファイルを必ず別にしてください。その後、タスクを実行してください。
- 作業は1画面ずつ行ってください。
- 必ず{画面遷移図}に基づいて、各画面のコンポーネントを設計してください。画面の遷移がスムーズに出来るように、分類された折り畳み式のメニューも作成してください。
- ペルソナによって画面構成を別にしてください。例えばユーザーとシステム管理者とは異なる画面を表示してください。

- 全てのWebアプリケーションの画面から、サービス毎にデプロイされたAzure Computeサービス上で動作しているREST APIのエンドポイント呼び出しを実装します。{サービスカタログ}を参考にして、必ず全てのデプロイ済みのAzure のサービスのエンドポイントに接続してください。

- 認証画面は、何を入力してもログインできるようにしてください。後で実装をします。

- 作業の進捗状況を、`work/{ユースケースID}/screen-implementation-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/screen-implementation-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

## ユースケースID
- UC-xxx

## 画面一覧
- docs/usecase/{ユースケースID}/screen/screen-list.md
  - {画面遷移図}も記載されている

## 画面定義書
- docs/usecase/{ユースケースID}/screen/{画面ID}-description.md

## 参考ドキュメント
- docs/usecase/{ユースケースID}/usecase-description.md
- docs/usecase/{ユースケースID}/data-model.md
- docs/usecase/{ユースケースID}/services/service-catalog.md
- data/{ユースケースID}/sample-data.json

## サービスカタログ
- docs/usecase/{ユースケースID}/service-catalog.md

## 作成フォルダ
- app/{ユースケースID}

## 技術仕様
- HTML5のみ使用
- JavaScript

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。

## 注意事項
- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に記載する。
```

以下、複数のパターンの例を示します。全てを使う必要はありません。

### (Option) Step.3.0.1. 複数のWeb画面を一度に表示

> [!NOTE]
> あくまで画面作成の例です。スキップして構いません。

複数のWeb画面を一度に表示させる際には、以下の様なIssueを作成して、GitHub Copilot Coding Agentに作業をしてもらいます。

```text
以下のアプリケーションの画面を一度に見る事ができる、[生産調整アプリケーション]を作成する

# 作成フォルダ
## 作成フォルダ
- `{app/フォルダ名}`

# 技術仕様
- 参照されるアプリケーション
  - [生産調整エージェント]
    - フォルダー名: adjustment-agent
  - [KPIモニタリングアプリケーション]
    - フォルダー名: kpi-monitoring-app
- HTML5のみで、それぞれの画面を参照する。独自の画面は作らない
- 画面上部にアプリケーションの一覧名が表示されているタブを作成してください。タブを切り替えると画面の下に、そのアプリケーションが表示されるようにしてください。
- 各アプリケーション参照のURLは、ルートからの絶対パスで指定をしてください。
- Azure Static Web Appsにデプロイできるようにする
- 現在あるすべてのGitHub Actionsは削除する

## 注意事項
- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記する。
```

### (Option) Step.3.0.2. (Option) マルチエージェントのグループチャットのサンプル

> [!NOTE]
> あくまで画面作成の例です。スキップして構いません。


マルチエージェントのグループチャットのサンプルです。

```text
[KPIモニタリングアプリケーション]と連携して、AIエージェントが生産の変更が可能かどうかを議論して、その議論の経過状況を確認できる画面を作成してください。

# 作成フォルダー
- app/adjustment-agent

# 技術仕様
- デモ用。サンプルデータを作成して、それを使う
- HTML5のみ
- 画面はチャットの形式
- アクターとしてAIエージェントがグループチャットをする。JP工場エージェント、US工場エージェント、販売総合管理エージェント、販売ローカル管理エージェント、畠山さん(人)、榎並さん(人)
  - 工場エージェントは、生産の調整が可能かどうかを現在の生産実績と、生産能力をもとにコメントする
  - 販売エージェントは、店舗での売り上げをもとにしてコメントする
  - 人は、工場と販売のエージェントの会話に割り込んで、人らしい生産量の調整をする
- 生産量の調整が必要なビジネス上の理由
  - JPで梅雨が通常より長く続いており、アイスAが昨年より需要下振れが予想され、スナックBが売られている
  - JP向けにスナックBを生産していた工場Aは増産枠がなく工場振替生産が必要
  - JPのアイスA の販売店では工場Dのライン連続生産を担保できないため、他事業間での調整が必要
- 画面に変更調整の指示をするというボタンを追加。そのボタンを押したら次の処理を実行
- その後、実行計画を作成する。実行計画は、画面に動的に作成したステップを順番に実行していく
- そのボタンを押したら、複数のエージェントが自分がどのデータを変更したらいいのかを画面でコメントする
- 調整後に、調整結果の要約を作成して画面に表示する

## 注意事項
- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記する。
```

## Step.3.1. Webアプリケーションのデプロイ

作成したWebアプリケーションをAzure Static Web Appsにデプロイします。

> [!IMPORTANT]
> ここでは、SPAあるいはStaticなHTMLの使用を前提にしています。Webサーバー側でHTML画面を生成する場合は、Azure Web Appsへのデプロイがお勧めです。

```text
# タスク
- WebアプリケーションのコードをMicrosoft Azureの`Azure Static Web Apps`へデプロイします。
- `Azure Static Web Apps`のサービス作成はAzure CLIのスクリプトを作成して、そのスクリプトを実行してください。Azure CLIの最新と詳細な仕様は、{MicrosoftDocs}のMCP Serverを必ず参照してください。作成したスクリプトは、Linuxで動作するファイルとして{Azure CLIのスクリプトの保存場所}に保存してください。 
- Azure CLIのスクリプトに必要なツールやパッケージのインストール用のスクリプトも作成してください。そのファイルは`infra/{ユースケースID}/create-azure-webui-resources-prep.sh`に保存してください。

- 継続的デリバリーを実装します。GitHub Actionsのワークフローを作成して、Azure Static Web Appsにデプロイしてください。GitHub Actionsの最新と詳細な仕様は、{MicrosoftDocs}のMCP Serverを必ず参照してください。

- Azureのサービスの作成が成功したら、{サービスカタログ}のドキュメントに、WebアプリケーションのURLを追記してください。

- 作業の進捗状況を、`work/{ユースケースID}/WebUI-azure-deploy-work-status.md`に日本語で追記してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/azure-service-deploy-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

- 機能の概要説明やアプリケーションの起動手順を日本語で`/README.md`に追記してください。

## ユースケースID
- UC-xxx

## Azure CLIのスクリプトの保存場所
- infra/{ユースケースID}/create-azure-webui-resources.sh

## サービスカタログ
- docs/usecase/{ユースケースID}/service-catalog.md

## 技術仕様
- リソースグループ名: `dahatake{YYYYMMDD}`
- リージョン: East Asia
  - もし利用できない場合は、Japan Westまたは、East Asia または South East Asia を選択してください。
- スケール設定は、最小構成で作成してください。
  - サーバーレスがあるサービスは、それを選択してください。
  - オートスケールがあるサービスは、それを選択してください。

# 行動規範
- 不確定な情報は推測せず、仮定と前提条件を明示する。
- ユーザーの意図を誤解しないため、重大な意思決定の前には確認を求める。
- 代替案や将来的な拡張案も併記し、意思決定がしやすい材料を提供する。
- 品質・セキュリティ・コスト・スケジュールのバランスを常に意識する。
```

Azure Static Web Appsの作成ができない場合があります。その場合は、以下の手順を試してください。

> ### ステップ1: Azureリソース作成
> cd infra/{ユースケースID}
> ./create-azure-webui-resources.sh
> ### ステップ2: デプロイトークンをコピー（スクリプト出力から）
> ### ステップ3: GitHub Secretsに設定
> #### 1. Settings > Secrets and variables > Actions
> #### 2. New repository secret
> #### 3. Name: AZURE_STATIC_WEB_APPS_API_TOKEN
> #### 4. Value: コピーしたトークン

## Step.4. アーキテクチャレビュー

Microsoftの公式ドキュメントの情報を活用して、展開されたアーキテクチャのレビューを行います。

```text
# 目的
- {レビューの対象のMicrosoft Azureのリソース}の全ての構成要素を高度に解析をしてください。
- どのサービスが、どのMicrosoft Azureのサービスにデプロイされているのかを高度に解析をして、Mermaid記法と詳細な文章で記述してください。{参考ドキュメント}も参考にしてください。
- Microsoftのベストプラクティスに基づいたアーキテクチャのレビューを行ってください。
- Microsoftのベストプラクティスに基づいたセキュリティのレビューを行ってください。
- 必ず`MicrosoftDocs`のMCP Serverから得られる情報を参考にしてください。
- レビューの結果は{レビュー結果の保存場所}に保存してください。
- 最初に目的に整合した、明確で実行可能な実行計画の手順を作成してください。構造的思考、ドメイン知識、ユーザー中心設計の原則を駆使し、アーキテクチャの網羅性、明確性、追跡可能性を確保します。その後、タスクを実行してください。
- 複数のレビュー案が考えられる場合は、それぞれのメリット・デメリットを比較して提示してください。

- 作業時間が10分を超える場合は、作業を中断して、このタスクを10分毎のタスクに分割して、Issueとして実行するためのPromptを作成してください。それぞれのPromptを`work/azure-architecture-review-issue-prompt-<番号>.md`に日本語で追記してください。

- ファイルを作成する際に、1つのファイルに大きな文字列を書き込む際に、書き込み処理が失敗する場合があります。ファイルは作成されているのに内容がEmptyになっています。その場合は、書き込む文字列を分割して、複数の回数に書き込み処理を分割して、1つのファイルに出力をしてください。

## ユースケースID
- UC-xxx

## レビューの対象のMicrosoft Azureのリソース
- リソースグループ名: `dahatake{YYYYMMDD}`

## 参考ドキュメント
- docs/usecase/{ユースケースID}/usecase-description.md
- docs/usecase/{ユースケースID}/service-catalog.md
- docs/usecase/{ユースケースID}/AzureServices-services.md
- docs/usecase/{ユースケースID}/AzureServices-data.md
- docs/usecase/{ユースケースID}/AzureServices-services-additional.md

## レビュー結果の保存場所
- docs/usecase/{ユースケースID}/Azure-ArchitectureReview-Report.md
```
