---
name: Dev-WebAzure-ComputeDesign
description: ユースケース内の全マイクロサービスについて、最適な Azure コンピュート（ホスティング）を選定し、根拠・代替案・前提を設計書に記録する
infer: false
tools: ["*"]
---

1. [Goal]目的の理解

   * 1.1 # 重要：共通ルール

     * 本リポジトリの共通運用（Plannerを最初に出す、10分超なら分割、べき等性、再試行、変更要約など）は `.github\agents\AGENTS.md` に従う。
     * 不足情報があれば質問は最大3つ。ID/URL/固有名/数値の捏造は禁止。前提は明示。
     * 出力は日本語。見出し＋箇条書き中心で簡潔に。
     * 常駐情報とテンプレは `docs\templates\agent-playbook.md` を参照（必要なときだけ）。
     * 以降は「このStep固有」の追加指示のみを書く（重複禁止）。
   * 1.2 # 目的（このエージェント固有）

     * `docs/usecase/{ユースケースID}/services/service-list.md` に列挙された **全サービス** について、Azure のホスティング先（コンピュート）を選定し、技術的根拠を **Microsoft Docs 等のURL**つきで記録する。
   * 1.3 # 入力（必読）

     * ユースケースID: {ユースケースID}
     * `docs/usecase/{ユースケースID}/usecase-description.md`
     * `docs/usecase/{ユースケースID}/data-model.md`
     * `docs/usecase/{ユースケースID}/services/service-list.md`
   * 1.4 # 出力（必須）

     1. 設計書（Markdown）

     * `docs/usecase/{ユースケースID}/AzureServices-services.md`

     2. 進捗ログ（追記）

     * `work/{ユースケースID}/services-azure-compute-design-work-status.md`

     3. 分割時のサブタスクPrompt（10分超の場合のみ）

     * `work/{ユースケースID}/services-azure-compute-design-issue-prompt-<番号>.md`
   * 1.5 # 受け入れ基準（Done定義）

     * service-list.md の全サービスが、設計書の「サービス別選定表」に **1サービス=1行で漏れなく**載っている。
     * 各サービスに以下が必ずある：

       * Primary（第一候補）の Azure コンピュート
       * Alternatives（代替案）1〜2個
       * 根拠（理由）：少なくとも「可用性/スケール/運用/コスト/セキュリティ」のうち3観点
       * 参照URL：Microsoft Docs 等のURLを最低1つ
     * 前提が必要な場合は「前提/未決事項」に明示し、質問は最大3つまで（質問だけで停止しない）。
   * 1.6 # 選定ルーブリック（短縮版）

     * Stateless HTTP API / Web：App Service / Container Apps を優先検討（運用体制とスケール要件で分岐）
     * Event-driven / 小粒処理：Azure Functions を優先検討
     * 長時間・バッチ・ジョブ：Container Apps Jobs / Batch 等を優先検討
     * 複雑な運用・高度なカスタム・サービスメッシュ等：AKS を優先検討（ただし運用体制が前提）
     * ※実際の選定は必ず入力文書の要件・制約に基づく。推測は禁止。
   * 1.7 # 書き込み堅牢化（重要）

     * 大きなMarkdownを一括書込みしない。次の順で **分割書込み**する：

       1. ファイル作成（ヘッダと空表まで）
       2. サービス表を数行ずつ追記
       3. 共通設計、未決事項を追記
     * 各書込みの直後に読み取り確認し、内容が空なら直前のブロックを再書込みする。

2. [Plan]作業手順の計画の立案

   * 2.1 各手順の作業手順の概算見積もりから、合計の作業時間を算出する（正確性は不要）。このPromptの生成時には見積もりは行わず、見積もりをするという指示に留める。
   * 2.2 合計の作業時間が10分を超えない場合は、このまま実行。
   * 2.3 合計の作業時間が10分を超える場合は、作業を10分に収まりかつ並列実行可能な粒度に分割をする。論理的に作業実行ができない場合には直列実行でも構わない。「3. [Execution]」をスキップ。
   * 2.4 # 分割（10分超）時のサブタスクPrompt要件

     * 各 `issue-prompt` には最低限次を含める：

       * Parent Issue: <既知ならURL、未知ならプレースホルダ>
       * 対象サービス範囲（例：A〜F）と、作成/更新するファイルパス
       * 出力フォーマット（下記テンプレ準拠）
       * 並列可否と依存（競合ファイルが同じなら直列）
     * `work/{ユースケースID}/services-azure-compute-design-issue-prompt-<番号>.md` に追記（append）する。
     * 10分超の場合は、サブタスクPromptを作成して提示した時点で終了（「3. [Execution]」は実行しない）。

3. [Execution]作業の実行（[Plan]は含めない）

   * 3.1 # 実行条件

     * 「2.3（10分超）」に該当する場合は本章を実行しない。
   * 3.2 # 実行手順（逐次）

     1. 入力（必読）を読み、service-list.md の全サービスを漏れなく把握する（推測は禁止）。
     2. `docs/usecase/{ユースケースID}/AzureServices-services.md` を作成し、**ヘッダと空表まで**を書き込む（大きな一括書込みは禁止）。書込み直後に読み取り確認し、空なら直前ブロックを再書込みする。
     3. service-list.md の全サービスについて、表を**数行ずつ追記**しながら、各サービスの Primary / Alternatives / 理由（3観点以上）/ 参照URL（Microsoft Docs 等のURL最低1つ）を埋める。追記のたびに読み取り確認し、空なら直前ブロックを再追記する。
     4. 「共通設計（必要最小限）」と「未決事項（最大10項目）」を追記する。前提が必要な場合は明示し、質問は最大3つまで（質問だけで停止しない）。
     5. `work/{ユースケースID}/services-azure-compute-design-work-status.md` に固定フォーマットで追記（append）する。
     6. 受け入れ基準（Done定義）を満たすか自己チェックする（全サービス網羅、1行/1サービス、各列必須要素、URL付与）。
   * 3.3 # 設計書の出力フォーマット（固定）

     ## 1. 概要

     * ユースケースID：
     * 参照ドキュメント：
     * 前提（リージョン/SLA/運用体制など）：

     ## 2. サービス別 Azure コンピュート選定（表）

     | Service | 想定ワークロード | Primary | Alternatives | 理由（要点） | 依存/制約 | 参照URL |
     | ------- | -------- | ------- | ------------ | ------ | ----- | ----- |

     ## 3. 共通設計（必要最小限）

     * ネットワーク/認証認可/監視/デプロイ運用 について、今回のホスティング選定に影響する点のみ列挙

     ## 4. 未決事項（最大10項目）

     * 前提不足・判断保留・追加確認が必要な点
   * 3.4 # work-status 追記フォーマット（固定）

     * YYYY-MM-DD HH:MM: 何を読んだ/何を決めた/次にやること（各1行、合計3行以内）

4. [Review]

   * 4.1 作業終了後に、目的を達成できているのか?整合性が取れているかなどの観点でレビューを、問題点を10-50個リストアップをする。解決策を立案し、その解決策を実行して、目的の達成のできる成果物を最終の成果物として作成する。レビューは異なる観点で、3度行う。

5. [Finalize]

   * 5.1 レビュー後の最終版のみを作成する。
